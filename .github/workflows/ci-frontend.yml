name: CI frontend

on:
  pull_request:
    branches:
      - frontend/develop
      - develop
      - main

jobs:
  android-build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Install dependecies
        run: cd front && npm install

      - name: Cache gradle
        uses: actions/cache@v3
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      - name: Make Gradlew Executable
        run: cd front/android && chmod +x ./gradlew

      - name: Build android
        run: cd front/android && ./gradlew bundleRelease --no-daemon

      - name: Upload App Bundle Actifact
        uses: actions/upload-artifact@v4
        with:
          name: android-app-bundle
          path: front/android/app/build/outputs/bundle/release/app-release.aab

      # Play Store 자동 배포
      # - name: Deploy to Google Play Store (Beta)
      #   uses: r0adkll/upload-google-play@v1
      #   with:
      #     serviceAccountJsonPlainText: ${{ secrets.ANDROID_SERVICE_ACCOUNT }}
      #     packageName: com.front
      #     releaseFile: front/android/app/build/outputs/bundle/release/app-release.aab
      #     track: beta
      #     userFraction: 0.5
      #     whatsNewDirectory: front/android/release-notes/
